<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics æ¸¬è©¦é é¢</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GPLJLSF9S0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GPLJLSF9S0', {
        // éš±ç§å‹å–„è¨­å®š
        anonymize_ip: true,
        allow_google_signals: false,
        allow_ad_personalization_signals: false
      });
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 2rem;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 2rem;
        }
        
        .test-section {
            margin: 1.5rem 0;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.5rem;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #28a745;
        }
        
        .error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Google Analytics æ¸¬è©¦é é¢</h1>
        
        <div class="test-section">
            <h3>åŸºæœ¬åŠŸèƒ½æ¸¬è©¦</h3>
            <button onclick="testPageView()">æ¸¬è©¦é é¢è¨ªå•</button>
            <button onclick="testThemeSelection()">æ¸¬è©¦ä¸»é¡Œé¸æ“‡</button>
            <button onclick="testPhotoUpload()">æ¸¬è©¦ç…§ç‰‡ä¸Šå‚³</button>
            <button onclick="testFrameStyle()">æ¸¬è©¦é‚Šæ¡†é¢¨æ ¼</button>
            <button onclick="testFormatChange()">æ¸¬è©¦æ ¼å¼åˆ‡æ›</button>
        </div>
        
        <div class="test-section">
            <h3>é€²éšåŠŸèƒ½æ¸¬è©¦</h3>
            <button onclick="testShare()">æ¸¬è©¦åˆ†äº«åŠŸèƒ½</button>
            <button onclick="testDownload()">æ¸¬è©¦ä¸‹è¼‰åŠŸèƒ½</button>
            <button onclick="testError()">æ¸¬è©¦éŒ¯èª¤è¿½è¹¤</button>
            <button onclick="testPrecisionMode()">æ¸¬è©¦ç²¾ç¢ºæ¨¡å¼</button>
        </div>
        
        <div class="test-section">
            <h3>è¨­å‚™è³‡è¨Š</h3>
            <button onclick="showDeviceInfo()">é¡¯ç¤ºè¨­å‚™è³‡è¨Š</button>
        </div>
        
        <div class="test-section">
            <h3>æ¸¬è©¦çµæœæ—¥èªŒ</h3>
            <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script type="module">
        import { analytics } from './src/analytics.js';
        
        // å°‡ analytics ç‰©ä»¶æš´éœ²åˆ°å…¨åŸŸä»¥ä¾¿æ¸¬è©¦
        window.analytics = analytics;
        
        // æ—¥èªŒåŠŸèƒ½
        window.logMessage = function(message, type = 'info') {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            log.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            log.scrollTop = log.scrollHeight;
        };
        
        // æ¸…é™¤æ—¥èªŒ
        window.clearLog = function() {
            document.getElementById('log').innerHTML = '';
        };
        
        // æ¸¬è©¦å‡½æ•¸
        window.testPageView = function() {
            try {
                analytics.trackPageView('test_page', 'test_theme');
                logMessage('âœ… é é¢è¨ªå•äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ é é¢è¨ªå•äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testThemeSelection = function() {
            try {
                analytics.trackThemeSelected('johnny-be-good', 'test');
                logMessage('âœ… ä¸»é¡Œé¸æ“‡äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ ä¸»é¡Œé¸æ“‡äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testPhotoUpload = function() {
            try {
                analytics.trackPhotoUpload('file_select', 'test_theme', 1234567);
                logMessage('âœ… ç…§ç‰‡ä¸Šå‚³äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ ç…§ç‰‡ä¸Šå‚³äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testFrameStyle = function() {
            try {
                analytics.trackFrameStyleSelected('modern-gallery', 'test_theme', false);
                logMessage('âœ… é‚Šæ¡†é¢¨æ ¼é¸æ“‡äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ é‚Šæ¡†é¢¨æ ¼é¸æ“‡äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testFormatChange = function() {
            try {
                analytics.trackFormatSelected('square', 'test_theme');
                logMessage('âœ… æ ¼å¼åˆ‡æ›äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ æ ¼å¼åˆ‡æ›äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testShare = function() {
            try {
                analytics.trackShare('native_share', 'square', 'test_theme', true);
                logMessage('âœ… åˆ†äº«äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ åˆ†äº«äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testDownload = function() {
            try {
                analytics.trackDownload('square', 'test_theme', true);
                logMessage('âœ… ä¸‹è¼‰äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ ä¸‹è¼‰äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testError = function() {
            try {
                analytics.trackError('test_error', 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦éŒ¯èª¤', 'test_context');
                logMessage('âœ… éŒ¯èª¤è¿½è¹¤äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ éŒ¯èª¤è¿½è¹¤äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.testPrecisionMode = function() {
            try {
                analytics.trackPrecisionMode('enter', 'test_theme', 5000);
                logMessage('âœ… ç²¾ç¢ºæ¨¡å¼äº‹ä»¶å·²ç™¼é€', 'success');
            } catch (error) {
                logMessage('âŒ ç²¾ç¢ºæ¨¡å¼äº‹ä»¶ç™¼é€å¤±æ•—: ' + error.message, 'error');
            }
        };
        
        window.showDeviceInfo = function() {
            try {
                const deviceType = analytics.getDeviceType();
                const currentTheme = analytics.getCurrentTheme();
                
                logMessage(`è¨­å‚™é¡å‹: ${deviceType}`, 'info');
                logMessage(`ç•¶å‰ä¸»é¡Œ: ${currentTheme}`, 'info');
                logMessage(`è¢å¹•è§£æåº¦: ${screen.width}x${screen.height}`, 'info');
                logMessage(`è¦–çª—å¤§å°: ${window.innerWidth}x${window.innerHeight}`, 'info');
                logMessage(`ç”¨æˆ¶ä»£ç†: ${navigator.userAgent.substring(0, 100)}...`, 'info');
                logMessage(`GA æ˜¯å¦å•Ÿç”¨: ${analytics.isEnabled}`, 'info');
            } catch (error) {
                logMessage('âŒ ç²å–è¨­å‚™è³‡è¨Šå¤±æ•—: ' + error.message, 'error');
            }
        };
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•é¡¯ç¤ºåˆå§‹åŒ–è³‡è¨Š
        document.addEventListener('DOMContentLoaded', () => {
            logMessage('ğŸ“Š Analytics æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ', 'success');
            logMessage(`GA è¿½è¹¤ ID: G-GPLJLSF9S0`, 'info');
            logMessage(`Analytics æ¨¡çµ„ç‹€æ…‹: ${analytics.isEnabled ? 'å·²å•Ÿç”¨' : 'æœªå•Ÿç”¨'}`, analytics.isEnabled ? 'success' : 'error');
            
            if (typeof gtag !== 'undefined') {
                logMessage('âœ… Google Analytics è…³æœ¬è¼‰å…¥æˆåŠŸ', 'success');
            } else {
                logMessage('âŒ Google Analytics è…³æœ¬è¼‰å…¥å¤±æ•—', 'error');
            }
        });
        
        // ç›£è½æ‰€æœ‰ gtag èª¿ç”¨ï¼ˆç”¨æ–¼èª¿è©¦ï¼‰
        if (typeof gtag !== 'undefined') {
            const originalGtag = gtag;
            window.gtag = function(...args) {
                logMessage(`ğŸ“¡ GA äº‹ä»¶: ${args[0]} - ${args[1]} - ${JSON.stringify(args[2] || {})}`, 'info');
                return originalGtag.apply(this, args);
            };
        }
    </script>
</body>
</html>